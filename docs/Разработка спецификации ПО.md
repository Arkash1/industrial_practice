# Разработка спецификации ПО

**QR Code Generator** — это Android-приложение для создания, кастомизации и сканирования QR-кодов. Приложение использует библиотеку **ZXing** для генерации, **ML Kit** для сканирования и локальную базу данных **Room** для хранения истории.

Приложение реализовано по архитектуре **MVVM**:

- **Model:** Сущность `QRCodeEntity`, DAO для доступа к данным (`QRCodeDao`), репозиторий `QRRepository`.
- **View:** Активности и фрагменты (`MainActivity`, `HomeFragment`, `ScannerFragment`, `HistoryFragment`), отображающие данные и камеру.
- **ViewModel:** `MainViewModel` обеспечивает связь между UI, бизнес-логикой генерации и базой данных.

База данных реализована через **Room**, хранит единую сущность истории кодов.

---

## а) Модуль базы данных

**Класс:** `AppDatabase`

**Функции:**
- Создание базы данных `qr-database`.
- Предоставление DAO для работы с историей кодов.
- Инициализация базы данных (Singleton).

**Ограничения:**
- Используется локальное хранилище на устройстве.
- Автоматическая миграция с удалением данных при конфликте версий (`fallbackToDestructiveMigration`).

---

## б) Модуль управления данными (История)

**Классы:** `QRCodeDao`, `QRCodeEntity`

**Функции DAO:**
- Сохранение сгенерированных и отсканированных кодов (`insert`).
- Удаление записей (`delete`, `deleteAll`).
- Получение всей истории (`getAllLive`), избранных записей (`getFavorites`), поиск по содержимому.
- Сортировка по дате создания (DESC).

**Сущности:**
- `QRCodeEntity`: ID, содержимое (content), тип данных, дата создания, путь к файлу (если сохранен), флаг `isScanned`, флаг `isFavorite`.

**Ограничения:**
- Максимальный размер текстового содержимого ограничен стандартом QR (до 4296 символов).
- Работа с БД выполняется асинхронно (в фоновых потоках).

---

## в) Модуль генерации и сканирования

**Классы:** `QRGeneratorService`, `ScanAnalyzer`

**Функции:**
- **Генерация:** Преобразование строки и настроек цвета в `Bitmap` с использованием `MultiFormatWriter` (ZXing).
- **Сканирование:** Анализ потока кадров с камеры через `ImageAnalysis.Analyzer` (CameraX) и распознавание кодов через `BarcodeScanning` (ML Kit).
- **Парсинг:** Определение типа данных (URL, Wi-Fi, Text) из сырой строки.

**Ограничения:**
- Генерация требует валидных входных данных (не null).
- Сканирование требует разрешения на использование камеры (`CAMERA_PERMISSION`).

---

## г) Модуль интерфейса пользователя

**Навигация:** `MainActivity` (BottomNavigation)
**Генерация:** `HomeFragment`, `CreateQrFragment` (по типам: Wifi, URL, Text)
**Сканер:** `ScannerFragment`
**История:** `HistoryFragment`
**Просмотр:** `ResultFragment`

**Особенности UI:**
- Использование `RecyclerView` для списка истории с `DiffUtil`.
- `CameraView` (PreviewView) для отображения потока камеры в реальном времени.
- Всплывающие диалоги (Bottom Sheet) для быстрого предпросмотра результата сканирования.

**Ограничения:**
- Интерфейс адаптирован под портретную ориентацию.
- Тяжелые операции (обработка изображения) вынесены из Main Thread, чтобы не блокировать UI.

---

## д) Модуль типов и утилит

**Enum:** `QRType`
**Utils:** `QRContentBuilder`, `FileSaver`

**Функции:**
- `QRType`: Перечисление поддерживаемых форматов (TEXT, URL, WIFI, PHONE, EMAIL).
- `QRContentBuilder`: Форматирование строк для специфических типов (например, `WIFI:S:MyNet;T:WPA;P:123;;`).
- `FileSaver`: Сохранение Bitmap в галерею устройства (`MediaStore` API).

**Ограничения:**
- Сохранение файлов требует соответствующих прав доступа в зависимости от версии Android (Scoped Storage).
